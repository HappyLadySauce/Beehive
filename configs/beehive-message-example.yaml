# Beehive Message Service 配置文件示例
# 复制此文件为 beehive-message.yaml 并根据实际环境修改

# HTTP 服务器配置
insecure-serving:
  bind-address: "0.0.0.0"
  bind-port: 8083

# gRPC 服务配置
grpc:
  # 绑定地址
  bind-address: "0.0.0.0"
  # 绑定端口
  bind-port: 50052
  # 最大接收消息大小（字节）
  max-recv-msg-size: 4194304  # 4MB
  # 最大发送消息大小（字节）
  max-send-msg-size: 4194304  # 4MB

# 数据库配置
database:
  # 主机地址
  host: localhost
  # 端口
  port: 5432
  # 用户名
  user: postgres
  # 密码
  password: postgres
  # 数据库名
  dbname: beehive
  # SSL 模式：disable, require, verify-ca, verify-full
  sslmode: disable
  # 最大空闲连接数
  max-idle-conns: 10
  # 最大打开连接数
  max-open-conns: 100
  # 连接最大生命周期（分钟）
  conn-max-lifetime: 60
  # 是否启用日志
  log-mode: false

# RabbitMQ 配置
rabbitmq:
  # 连接 URL
  url: amqp://guest:guest@localhost:5672/
  # 交换机配置
  exchanges:
    # 单聊交换机
    direct:
      name: im.direct
      type: direct
      durable: true
    # 群聊交换机
    topic:
      name: im.topic
      type: topic
      durable: true
  # 是否自动重连
  auto-reconnect: true
  # 重连间隔（秒）
  reconnect-interval: 5

# Elasticsearch 配置
elasticsearch:
  # Elasticsearch 地址列表
  addresses:
    - http://localhost:9200
  
  # 索引名称
  index: beehive-messages
  
  # 是否启用同步到 Elasticsearch
  sync-enabled: true
  
  # 同步模式：sync（同步）, async（异步）
  sync-mode: async
  
  # 异步同步配置
  async:
    # 工作线程数
    workers: 5
    # 队列大小
    queue-size: 1000
    # 批量索引大小
    batch-size: 100
    # 批量索引间隔（秒）
    batch-interval: 5
  
  # 重试配置
  retry:
    # 是否启用重试
    enabled: true
    # 最大重试次数
    max-attempts: 3
    # 重试间隔（秒）
    interval: 10

# etcd 配置（服务注册与发现）
etcd:
  # etcd 端点列表
  endpoints:
    - localhost:2379
  
  # 拨号超时时间
  dial-timeout: 5s
  
  # 服务注册前缀
  prefix: "/beehive/services"
  
  # 租约 TTL（秒）
  lease-ttl: 10
  
  # 用户名（如果启用了认证）
  username: ""
  
  # 密码（如果启用了认证）
  password: ""

# 日志配置
log:
  # 日志级别：debug, info, warn, error
  level: info
  # 日志格式：json, text
  format: json
  # 日志输出路径，空字符串表示标准输出
  output-path: ""
  # 错误日志输出路径
  error-output-path: ""

# 服务配置
service:
  # 服务名称
  name: beehive-message
  # 服务版本
  version: "1.0.0"
  # 实例 ID（为空则自动生成）
  instance-id: ""
  # 元数据
  metadata:
    region: "us-east-1"
    zone: "us-east-1a"

# 消息配置
message:
  # 消息内容最大长度（字符）
  max-content-length: 5000
  # 消息历史查询默认限制
  default-history-limit: 50
  # 消息历史查询最大限制
  max-history-limit: 200
  # 是否启用消息内容审核
  enable-moderation: false

# 健康检查配置
health:
  # 健康检查端口
  port: 8081
  # 健康检查路径
  path: "/health"
  # 就绪检查路径
  ready-path: "/ready"
